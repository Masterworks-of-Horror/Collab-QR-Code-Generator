<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MOH Collab Card QR Codes</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Asul:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0f0f0f;
      color: #e0e0e0;
      min-height: 100vh;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 24px;
    }

    h1 {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
      color: #fff;
    }

    .subtitle {
      color: #888;
      margin-bottom: 32px;
      font-size: 15px;
    }

    .panel {
      background: #1a1a1a;
      border: 1px solid #2a2a2a;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
    }

    .panel h2 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 16px;
      color: #ccc;
    }

    /* Unlock All button */
    .unlock-all-btn {
      display: block;
      width: 100%;
      background: linear-gradient(135deg, #7c3aed, #3b82f6);
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 16px 24px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      margin-bottom: 12px;
      transition: opacity 0.15s;
      letter-spacing: 0.3px;
    }

    .unlock-all-btn:hover { opacity: 0.9; }

    .unlock-all-hint {
      text-align: center;
      font-size: 12px;
      color: #666;
      margin-bottom: 8px;
    }

    /* Card grid */
    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 12px;
    }

    .card-btn {
      background: #222;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 12px 14px;
      color: #ccc;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.15s;
      text-align: left;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .card-btn:hover {
      background: #2a2a2a;
      border-color: #555;
      color: #fff;
    }

    .card-btn.active {
      background: #1e3a5f;
      border-color: #3b82f6;
      color: #93c5fd;
    }

    .card-btn .card-num {
      font-weight: 700;
      color: #666;
      font-size: 13px;
      min-width: 24px;
      margin-right: 10px;
    }

    .card-btn.active .card-num { color: #60a5fa; }

    .card-btn .card-name { flex: 1; font-weight: 500; }

    .card-btn .card-id {
      font-family: 'Courier New', monospace;
      font-size: 11px;
      color: #555;
      margin-left: 8px;
    }

    .card-btn.active .card-id { color: #7cb3f0; }

    /* Customize row */
    .customize-row {
      display: flex;
      gap: 24px;
      flex-wrap: wrap;
    }

    .color-picker-wrap {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .color-picker-wrap label {
      font-size: 13px;
      font-weight: 500;
      color: #999;
      margin: 0;
    }

    .color-picker-wrap input[type="color"] {
      width: 48px;
      height: 48px;
      padding: 2px;
      border: 1px solid #444;
      border-radius: 8px;
      background: #111;
      cursor: pointer;
    }

    /* Output */
    .output {
      display: none;
      text-align: center;
    }

    .output.visible { display: block; }

    .output-card-id {
      font-size: 13px;
      color: #888;
      margin-bottom: 16px;
    }

    /* Card preview */
    .card-preview {
      display: inline-block;
      padding: 32px 32px 24px;
      border-radius: 16px;
      margin-bottom: 16px;
      transition: background-color 0.2s;
    }

    #qrcode {
      display: inline-block;
      padding: 12px;
      background: #fff;
      border-radius: 10px;
    }

    #qrcode img, #qrcode canvas { display: block; }

    .card-preview-name {
      font-family: 'Asul', serif;
      font-size: 22px;
      font-weight: 700;
      margin-top: 16px;
      letter-spacing: 0.5px;
    }

    .deep-link-display {
      background: #111;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 12px 16px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      color: #93c5fd;
      word-break: break-all;
      margin-bottom: 16px;
      text-align: left;
    }

    .output-actions {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .action-btn {
      background: #222;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 8px 16px;
      color: #ccc;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .action-btn:hover {
      background: #2a2a2a;
      border-color: #555;
      color: #fff;
    }

    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(80px);
      background: #333;
      color: #fff;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 14px;
      opacity: 0;
      transition: all 0.3s;
      pointer-events: none;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
  </style>
</head>
<body>

<div class="container">
  <h1>MOH Collab Card QR Codes</h1>
  <p class="subtitle">Scan a QR code to unlock collab cards in Masterworks of Horror</p>

  <!-- Unlock All -->
  <div class="panel">
    <button class="unlock-all-btn" onclick="selectUnlockAll()">Unlock ALL 21 Cards</button>
    <p class="unlock-all-hint">Generates a single QR code that unlocks every collab card at once</p>
  </div>

  <!-- Individual Cards -->
  <div class="panel">
    <h2>Individual Cards</h2>
    <div class="card-grid" id="cardGrid"></div>
  </div>

  <!-- Customize -->
  <div class="panel output" id="customizePanel">
    <h2>Customize</h2>
    <div class="customize-row">
      <div class="color-picker-wrap">
        <label for="bgColor">Card Background</label>
        <input type="color" id="bgColor" value="#1a1a1a">
      </div>
      <div class="color-picker-wrap">
        <label for="textColor">Text Color</label>
        <input type="color" id="textColor" value="#ffffff">
      </div>
    </div>
  </div>

  <!-- Output -->
  <div class="panel output" id="outputPanel">
    <div class="output-card-id" id="outputId"></div>
    <div class="card-preview" id="cardPreview">
      <div id="qrcode"></div>
      <div class="card-preview-name" id="previewName"></div>
    </div>
    <div class="deep-link-display" id="linkDisplay"></div>
    <div class="output-actions">
      <button class="action-btn" onclick="copyLink()">Copy Link</button>
      <button class="action-btn" onclick="downloadQR()">Download PNG</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const CARDS = [
  { num: 1,  name: "Sisyphus's Boulder",  id: "MOH1-300" },
  { num: 2,  name: "Bouldy (Token)",       id: "MOH1-301" },
  { num: 3,  name: "Robot Arms",           id: "MOH1-302" },
  { num: 4,  name: "Robot Legs",           id: "MOH1-303" },
  { num: 5,  name: "Robot Chassis",        id: "MOH1-304" },
  { num: 6,  name: "Mega Brawler",         id: "MOH1-305" },
  { num: 7,  name: "Glorgo",               id: "MOH1-306" },
  { num: 8,  name: "Dozer",                id: "MOH1-307" },
  { num: 9,  name: "A Suffocated Poem",    id: "MOH1-308" },
  { num: 10, name: "Lil Chomper",          id: "MOH1-309" },
  { num: 11, name: "Orbital Strike",       id: "MOH1-310" },
  { num: 12, name: "413 \u00BD W Clark St",id: "MOH1-311" },
  { num: 13, name: "Mama Spider",          id: "MOH1-312" },
  { num: 14, name: "Baby Spider",          id: "MOH1-313" },
  { num: 15, name: "Melon",                id: "MOH1-314" },
  { num: 16, name: "Mango Tree!",          id: "MOH1-315" },
  { num: 17, name: "A Difficult Choice",   id: "MOH1-316" },
  { num: 18, name: "Scout",                id: "MOH1-317" },
  { num: 19, name: "Clofin",               id: "MOH1-318" },
  { num: 20, name: "Tami",                 id: "MOH1-319" },
  { num: 21, name: "Larry",                id: "MOH1-320" }
];

const UNLOCK_ALL_URI = "moh://unlock?cards=" + CARDS.map(c => c.id).join(",");

let currentUri = "";
let currentLabel = "";

// Color pickers
const bgColorInput = document.getElementById("bgColor");
const textColorInput = document.getElementById("textColor");

bgColorInput.addEventListener("input", updatePreviewStyle);
textColorInput.addEventListener("input", updatePreviewStyle);

function updatePreviewStyle() {
  const preview = document.getElementById("cardPreview");
  const nameEl = document.getElementById("previewName");
  if (preview) preview.style.backgroundColor = bgColorInput.value;
  if (nameEl) nameEl.style.color = textColorInput.value;
}

// Render card grid
const grid = document.getElementById("cardGrid");
CARDS.forEach((card, i) => {
  const btn = document.createElement("button");
  btn.className = "card-btn";
  btn.id = "card-btn-" + i;
  btn.innerHTML = `<span class="card-num">#${card.num}</span><span class="card-name">${card.name}</span><span class="card-id">${card.id}</span>`;
  btn.onclick = () => selectCard(i);
  grid.appendChild(btn);
});

function clearActive() {
  document.querySelectorAll(".card-btn").forEach(b => b.classList.remove("active"));
  document.querySelector(".unlock-all-btn").style.outline = "none";
}

function selectCard(index) {
  clearActive();
  document.getElementById("card-btn-" + index).classList.add("active");

  const card = CARDS[index];
  currentUri = `moh://unlock?card=${card.id}`;
  currentLabel = card.name;

  document.getElementById("outputId").textContent = `#${card.num} â€” ${card.id}`;
  document.getElementById("previewName").textContent = card.name;
  generateQR(currentUri);
}

function selectUnlockAll() {
  clearActive();
  document.querySelector(".unlock-all-btn").style.outline = "2px solid #7c3aed";

  currentUri = UNLOCK_ALL_URI;
  currentLabel = "Unlock ALL Cards";

  document.getElementById("outputId").textContent = "MOH1-300 through MOH1-320";
  document.getElementById("previewName").textContent = "Unlock ALL Cards";
  generateQR(currentUri);
}

function generateQR(uri) {
  const qrContainer = document.getElementById("qrcode");
  qrContainer.innerHTML = "";

  new QRCode(qrContainer, {
    text: uri,
    width: 256,
    height: 256,
    colorDark: "#000000",
    colorLight: "#ffffff",
    correctLevel: QRCode.CorrectLevel.H
  });

  // Apply preview styles
  updatePreviewStyle();

  document.getElementById("linkDisplay").textContent = uri;
  document.getElementById("customizePanel").classList.add("visible");
  document.getElementById("outputPanel").classList.add("visible");
  document.getElementById("outputPanel").scrollIntoView({ behavior: "smooth", block: "center" });
}

function copyLink() {
  navigator.clipboard.writeText(currentUri).then(() => showToast("Link copied!"));
}

function downloadQR() {
  const qrCanvas = document.querySelector("#qrcode canvas");
  const qrImg = document.querySelector("#qrcode img");
  if (!qrCanvas && !qrImg) return;

  document.fonts.ready.then(() => {
    const bgColor = bgColorInput.value;
    const txtColor = textColorInput.value;
    const label = currentLabel;

    const padding = 40;
    const qrSize = 256;
    const textHeight = 40;
    const gap = 16;
    const cardWidth = qrSize + padding * 2;
    const cardHeight = padding + qrSize + gap + textHeight + padding;

    const offscreen = document.createElement("canvas");
    offscreen.width = cardWidth;
    offscreen.height = cardHeight;
    const ctx = offscreen.getContext("2d");

    // Background
    ctx.fillStyle = bgColor;
    ctx.fillRect(0, 0, cardWidth, cardHeight);

    // QR code
    const drawQR = (qrSource) => {
      const qrX = (cardWidth - qrSize) / 2;
      const qrY = padding;
      ctx.drawImage(qrSource, qrX, qrY, qrSize, qrSize);

      // Card name text
      ctx.fillStyle = txtColor;
      ctx.font = "bold 22px 'Asul', serif";
      ctx.textAlign = "center";
      ctx.textBaseline = "top";
      ctx.fillText(label, cardWidth / 2, padding + qrSize + gap, cardWidth - 32);

      // Download
      const a = document.createElement("a");
      a.href = offscreen.toDataURL("image/png");
      const safeName = label.replace(/[^a-zA-Z0-9]/g, "_").toLowerCase();
      a.download = `moh_${safeName}.png`;
      a.click();
      showToast("QR card downloaded!");
    };

    if (qrCanvas) {
      drawQR(qrCanvas);
    } else {
      const tempImg = new Image();
      tempImg.crossOrigin = "anonymous";
      tempImg.onload = () => drawQR(tempImg);
      tempImg.src = qrImg.src;
    }
  });
}

function showToast(msg) {
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.classList.add("show");
  setTimeout(() => t.classList.remove("show"), 2000);
}
</script>

</body>
</html>
