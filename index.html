<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Deep Link QR Code Generator</title>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0f0f0f;
      color: #e0e0e0;
      min-height: 100vh;
    }

    .container {
      max-width: 860px;
      margin: 0 auto;
      padding: 40px 24px;
    }

    h1 {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
      color: #fff;
    }

    .subtitle {
      color: #888;
      margin-bottom: 32px;
      font-size: 15px;
    }

    .panel {
      background: #1a1a1a;
      border: 1px solid #2a2a2a;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
    }

    .panel h2 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 16px;
      color: #ccc;
    }

    /* Preset grid */
    .presets {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
      gap: 8px;
      margin-bottom: 20px;
    }

    .preset-btn {
      background: #222;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 10px 12px;
      color: #ccc;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.15s;
      text-align: left;
    }

    .preset-btn:hover {
      background: #2a2a2a;
      border-color: #555;
      color: #fff;
    }

    .preset-btn.active {
      background: #1e3a5f;
      border-color: #3b82f6;
      color: #93c5fd;
    }

    .preset-btn .preset-icon {
      font-size: 18px;
      display: block;
      margin-bottom: 4px;
    }

    .preset-btn .preset-label {
      font-weight: 500;
    }

    /* Form */
    label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      color: #999;
      margin-bottom: 6px;
      margin-top: 14px;
    }

    label:first-child { margin-top: 0; }

    input, select, textarea {
      width: 100%;
      background: #111;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 10px 12px;
      color: #e0e0e0;
      font-size: 14px;
      font-family: inherit;
      outline: none;
      transition: border-color 0.15s;
    }

    input:focus, select:focus, textarea:focus {
      border-color: #3b82f6;
    }

    textarea { resize: vertical; min-height: 60px; }

    .hint {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }

    .field-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .dynamic-fields { margin-top: 14px; }

    /* Generate button */
    .generate-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #3b82f6;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 20px;
      transition: background 0.15s;
    }

    .generate-btn:hover { background: #2563eb; }

    /* Output */
    .output {
      display: none;
      text-align: center;
    }

    .output.visible { display: block; }

    #qrcode {
      display: inline-block;
      padding: 16px;
      background: #fff;
      border-radius: 12px;
      margin-bottom: 16px;
    }

    #qrcode img { display: block; }

    .deep-link-display {
      background: #111;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 12px 16px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      color: #93c5fd;
      word-break: break-all;
      margin-bottom: 16px;
      text-align: left;
    }

    .output-actions {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .action-btn {
      background: #222;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 8px 16px;
      color: #ccc;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .action-btn:hover {
      background: #2a2a2a;
      border-color: #555;
      color: #fff;
    }

    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(80px);
      background: #333;
      color: #fff;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 14px;
      opacity: 0;
      transition: all 0.3s;
      pointer-events: none;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    /* QR customization */
    .color-row {
      display: flex;
      gap: 16px;
      align-items: center;
      margin-top: 8px;
    }

    .color-picker-wrap {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .color-picker-wrap input[type="color"] {
      width: 36px;
      height: 36px;
      padding: 2px;
      border-radius: 6px;
      cursor: pointer;
    }

    .size-slider {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 8px;
    }

    .size-slider input[type="range"] {
      flex: 1;
      accent-color: #3b82f6;
    }

    .size-slider span {
      font-size: 13px;
      color: #888;
      min-width: 50px;
    }
  </style>
</head>
<body>

<div class="container">
  <h1>Deep Link QR Generator</h1>
  <p class="subtitle">Generate QR codes for app deep links, universal links, and custom URI schemes</p>

  <!-- Presets -->
  <div class="panel">
    <h2>Quick Presets</h2>
    <div class="presets" id="presets"></div>
  </div>

  <!-- Link Builder -->
  <div class="panel">
    <h2>Link Builder</h2>

    <label for="scheme">URI Scheme / Protocol</label>
    <input type="text" id="scheme" placeholder="e.g. myapp://, https://, fb://">

    <div class="dynamic-fields" id="dynamicFields"></div>

    <label for="fullUri" style="margin-top:18px">Full Deep Link URI</label>
    <textarea id="fullUri" placeholder="The complete deep link will appear here, or type your own"></textarea>
    <p class="hint">Edit directly or use the fields above to build the link</p>

    <!-- QR Options -->
    <label>QR Code Size</label>
    <div class="size-slider">
      <input type="range" id="qrSize" min="128" max="512" value="256" step="16">
      <span id="qrSizeLabel">256px</span>
    </div>

    <label>Colors</label>
    <div class="color-row">
      <div class="color-picker-wrap">
        <input type="color" id="qrDark" value="#000000">
        <span style="font-size:13px;color:#999">Foreground</span>
      </div>
      <div class="color-picker-wrap">
        <input type="color" id="qrLight" value="#ffffff">
        <span style="font-size:13px;color:#999">Background</span>
      </div>
    </div>

    <button class="generate-btn" onclick="generateQR()">Generate QR Code</button>
  </div>

  <!-- Output -->
  <div class="panel output" id="outputPanel">
    <h2>Your QR Code</h2>
    <div id="qrcode"></div>
    <div class="deep-link-display" id="linkDisplay"></div>
    <div class="output-actions">
      <button class="action-btn" onclick="copyLink()">Copy Link</button>
      <button class="action-btn" onclick="downloadQR()">Download PNG</button>
      <button class="action-btn" onclick="downloadSVG()">Download SVG</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// Deep link presets
const PRESETS = [
  {
    label: 'Custom App', icon: 'ðŸ“±',
    scheme: 'myapp://',
    fields: [
      { id: 'path', label: 'Path', placeholder: 'e.g. product/123, screen/home' },
      { id: 'params', label: 'Query Params', placeholder: 'e.g. id=42&ref=qr' }
    ],
    build: (f) => `myapp://${f.path}${f.params ? '?' + f.params : ''}`
  },
  {
    label: 'iOS Universal', icon: 'ðŸŽ',
    scheme: 'https://',
    fields: [
      { id: 'domain', label: 'Domain', placeholder: 'e.g. myapp.com' },
      { id: 'path', label: 'Path', placeholder: 'e.g. /product/123' },
      { id: 'params', label: 'Query Params', placeholder: 'e.g. utm_source=qr' }
    ],
    build: (f) => `https://${f.domain}${f.path}${f.params ? '?' + f.params : ''}`
  },
  {
    label: 'Android Intent', icon: 'ðŸ¤–',
    scheme: 'intent://',
    fields: [
      { id: 'host', label: 'Host/Path', placeholder: 'e.g. product/123' },
      { id: 'package', label: 'Package Name', placeholder: 'e.g. com.example.app' },
      { id: 'fallback', label: 'Fallback URL', placeholder: 'https://play.google.com/store/apps/details?id=...' }
    ],
    build: (f) => `intent://${f.host}#Intent;scheme=https;package=${f.package};S.browser_fallback_url=${encodeURIComponent(f.fallback || '')};end`
  },
  {
    label: 'Android App Link', icon: 'ðŸ”—',
    scheme: 'https://',
    fields: [
      { id: 'domain', label: 'Domain', placeholder: 'e.g. myapp.com' },
      { id: 'path', label: 'Path', placeholder: 'e.g. /share/abc123' },
      { id: 'params', label: 'Query Params', placeholder: 'e.g. ref=qr' }
    ],
    build: (f) => `https://${f.domain}${f.path}${f.params ? '?' + f.params : ''}`
  },
  {
    label: 'WhatsApp', icon: 'ðŸ’¬',
    scheme: 'https://wa.me/',
    fields: [
      { id: 'phone', label: 'Phone Number', placeholder: '1234567890 (with country code, no +)' },
      { id: 'text', label: 'Pre-filled Message', placeholder: 'Hello!' }
    ],
    build: (f) => `https://wa.me/${f.phone}${f.text ? '?text=' + encodeURIComponent(f.text) : ''}`
  },
  {
    label: 'Telegram', icon: 'âœˆï¸',
    scheme: 'https://t.me/',
    fields: [
      { id: 'target', label: 'Username or Invite', placeholder: 'e.g. mybot or +InviteHash' }
    ],
    build: (f) => `https://t.me/${f.target}`
  },
  {
    label: 'Instagram', icon: 'ðŸ“·',
    scheme: 'instagram://',
    fields: [
      { id: 'type', label: 'Type', placeholder: 'user, media, or tag' },
      { id: 'value', label: 'Value', placeholder: 'username, media ID, or tag name' }
    ],
    build: (f) => {
      if (f.type === 'user') return `instagram://user?username=${f.value}`;
      if (f.type === 'media') return `instagram://media?id=${f.value}`;
      if (f.type === 'tag') return `instagram://tag?name=${f.value}`;
      return `instagram://${f.type}?${f.value}`;
    }
  },
  {
    label: 'Twitter / X', icon: 'ðŸ¦',
    scheme: 'twitter://',
    fields: [
      { id: 'action', label: 'Action', placeholder: 'user, status, or post' },
      { id: 'value', label: 'Value', placeholder: 'username, tweet ID, or text to tweet' }
    ],
    build: (f) => {
      if (f.action === 'user') return `twitter://user?screen_name=${f.value}`;
      if (f.action === 'status') return `twitter://status?id=${f.value}`;
      if (f.action === 'post') return `twitter://post?message=${encodeURIComponent(f.value)}`;
      return `twitter://${f.action}`;
    }
  },
  {
    label: 'YouTube', icon: 'â–¶ï¸',
    scheme: 'https://youtu.be/',
    fields: [
      { id: 'videoId', label: 'Video ID', placeholder: 'e.g. dQw4w9WgXcQ' },
      { id: 'time', label: 'Start Time (s)', placeholder: 'e.g. 30' }
    ],
    build: (f) => `https://youtu.be/${f.videoId}${f.time ? '?t=' + f.time : ''}`
  },
  {
    label: 'Spotify', icon: 'ðŸŽµ',
    scheme: 'spotify://',
    fields: [
      { id: 'type', label: 'Type', placeholder: 'track, album, playlist, artist' },
      { id: 'id', label: 'Spotify ID', placeholder: 'e.g. 6rqhFgbbKwnb9MLmUQDhG6' }
    ],
    build: (f) => `spotify://${f.type}/${f.id}`
  },
  {
    label: 'Maps', icon: 'ðŸ—ºï¸',
    scheme: 'geo:',
    fields: [
      { id: 'lat', label: 'Latitude', placeholder: 'e.g. 37.7749' },
      { id: 'lng', label: 'Longitude', placeholder: 'e.g. -122.4194' },
      { id: 'query', label: 'Search Query', placeholder: 'e.g. coffee shops' }
    ],
    build: (f) => `geo:${f.lat || 0},${f.lng || 0}${f.query ? '?q=' + encodeURIComponent(f.query) : ''}`
  },
  {
    label: 'Email', icon: 'ðŸ“§',
    scheme: 'mailto:',
    fields: [
      { id: 'email', label: 'Email Address', placeholder: 'user@example.com' },
      { id: 'subject', label: 'Subject', placeholder: 'Hello!' },
      { id: 'body', label: 'Body', placeholder: 'Message content...' }
    ],
    build: (f) => {
      let uri = `mailto:${f.email}`;
      const params = [];
      if (f.subject) params.push(`subject=${encodeURIComponent(f.subject)}`);
      if (f.body) params.push(`body=${encodeURIComponent(f.body)}`);
      if (params.length) uri += '?' + params.join('&');
      return uri;
    }
  },
  {
    label: 'Phone / SMS', icon: 'ðŸ“ž',
    scheme: 'tel:',
    fields: [
      { id: 'type', label: 'Type (tel or sms)', placeholder: 'tel or sms' },
      { id: 'number', label: 'Phone Number', placeholder: '+1234567890' },
      { id: 'body', label: 'SMS Body (sms only)', placeholder: 'Message text...' }
    ],
    build: (f) => {
      if (f.type === 'sms') return `sms:${f.number}${f.body ? '?body=' + encodeURIComponent(f.body) : ''}`;
      return `tel:${f.number}`;
    }
  },
  {
    label: 'Slack', icon: 'ðŸ’¼',
    scheme: 'slack://',
    fields: [
      { id: 'team', label: 'Team ID', placeholder: 'T0123456789' },
      { id: 'channel', label: 'Channel ID', placeholder: 'C0123456789' }
    ],
    build: (f) => `slack://channel?team=${f.team}&id=${f.channel}`
  },
  {
    label: 'Zoom', icon: 'ðŸŽ¥',
    scheme: 'zoomus://',
    fields: [
      { id: 'confno', label: 'Meeting ID', placeholder: '1234567890' },
      { id: 'pwd', label: 'Password', placeholder: 'optional' }
    ],
    build: (f) => `zoomus://zoom.us/join?confno=${f.confno}${f.pwd ? '&pwd=' + f.pwd : ''}`
  },
  {
    label: 'Custom URI', icon: 'ðŸ”§',
    scheme: '',
    fields: [
      { id: 'uri', label: 'Full URI', placeholder: 'e.g. myscheme://path?key=value' }
    ],
    build: (f) => f.uri || ''
  }
];

let activePreset = null;
let qrInstance = null;

// Render presets
const presetsContainer = document.getElementById('presets');
PRESETS.forEach((preset, i) => {
  const btn = document.createElement('button');
  btn.className = 'preset-btn';
  btn.innerHTML = `<span class="preset-icon">${preset.icon}</span><span class="preset-label">${preset.label}</span>`;
  btn.onclick = () => selectPreset(i);
  presetsContainer.appendChild(btn);
});

function selectPreset(index) {
  activePreset = PRESETS[index];

  // Update active style
  document.querySelectorAll('.preset-btn').forEach((btn, i) => {
    btn.classList.toggle('active', i === index);
  });

  // Update scheme
  document.getElementById('scheme').value = activePreset.scheme;

  // Build dynamic fields
  const container = document.getElementById('dynamicFields');
  container.innerHTML = '';
  activePreset.fields.forEach(field => {
    const label = document.createElement('label');
    label.setAttribute('for', 'field_' + field.id);
    label.textContent = field.label;

    const input = document.createElement('input');
    input.type = 'text';
    input.id = 'field_' + field.id;
    input.placeholder = field.placeholder;
    input.oninput = updateUri;

    container.appendChild(label);
    container.appendChild(input);
  });

  updateUri();
}

function updateUri() {
  if (!activePreset) return;
  const fieldValues = {};
  activePreset.fields.forEach(f => {
    fieldValues[f.id] = document.getElementById('field_' + f.id)?.value || '';
  });
  document.getElementById('fullUri').value = activePreset.build(fieldValues);
}

function generateQR() {
  const uri = document.getElementById('fullUri').value.trim();
  if (!uri) {
    showToast('Enter a deep link URI first');
    return;
  }

  const size = parseInt(document.getElementById('qrSize').value);
  const darkColor = document.getElementById('qrDark').value;
  const lightColor = document.getElementById('qrLight').value;

  const qrContainer = document.getElementById('qrcode');
  qrContainer.innerHTML = '';

  qrInstance = new QRCode(qrContainer, {
    text: uri,
    width: size,
    height: size,
    colorDark: darkColor,
    colorLight: lightColor,
    correctLevel: QRCode.CorrectLevel.H
  });

  document.getElementById('linkDisplay').textContent = uri;
  document.getElementById('outputPanel').classList.add('visible');
  document.getElementById('outputPanel').scrollIntoView({ behavior: 'smooth', block: 'center' });
}

function copyLink() {
  const uri = document.getElementById('fullUri').value.trim();
  navigator.clipboard.writeText(uri).then(() => showToast('Link copied!'));
}

function downloadQR() {
  const canvas = document.querySelector('#qrcode canvas');
  if (!canvas) {
    // Fallback to img
    const img = document.querySelector('#qrcode img');
    if (img) {
      const a = document.createElement('a');
      a.href = img.src;
      a.download = 'qrcode.png';
      a.click();
    }
    return;
  }
  const a = document.createElement('a');
  a.href = canvas.toDataURL('image/png');
  a.download = 'qrcode.png';
  a.click();
  showToast('QR code downloaded!');
}

function downloadSVG() {
  const uri = document.getElementById('fullUri').value.trim();
  const size = parseInt(document.getElementById('qrSize').value);
  const darkColor = document.getElementById('qrDark').value;
  const lightColor = document.getElementById('qrLight').value;

  // Generate QR data matrix manually for SVG
  const qrTemp = document.createElement('div');
  qrTemp.style.display = 'none';
  document.body.appendChild(qrTemp);

  // Use the canvas to read pixel data
  const canvas = document.querySelector('#qrcode canvas');
  if (!canvas) {
    showToast('Generate a QR code first');
    return;
  }

  const ctx = canvas.getContext('2d');
  const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
  const moduleCount = findModuleCount(imgData, canvas.width);
  const cellSize = canvas.width / moduleCount;

  let svgPaths = '';
  for (let row = 0; row < moduleCount; row++) {
    for (let col = 0; col < moduleCount; col++) {
      const x = Math.floor(col * cellSize + cellSize / 2);
      const y = Math.floor(row * cellSize + cellSize / 2);
      const idx = (y * canvas.width + x) * 4;
      const r = imgData.data[idx];
      const g = imgData.data[idx + 1];
      const b = imgData.data[idx + 2];
      const isDark = (r + g + b) / 3 < 128;
      if (isDark) {
        svgPaths += `<rect x="${col}" y="${row}" width="1" height="1" fill="${darkColor}"/>`;
      }
    }
  }

  const svg = `<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${moduleCount} ${moduleCount}" width="${size}" height="${size}">
  <rect width="${moduleCount}" height="${moduleCount}" fill="${lightColor}"/>
  ${svgPaths}
</svg>`;

  const blob = new Blob([svg], { type: 'image/svg+xml' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'qrcode.svg';
  a.click();
  URL.revokeObjectURL(a.href);
  document.body.removeChild(qrTemp);
  showToast('SVG downloaded!');
}

function findModuleCount(imgData, width) {
  // Scan the first row to find module size by looking at color transitions
  let firstDark = -1;
  let firstLight = -1;
  for (let x = 0; x < width; x++) {
    const idx = x * 4;
    const bright = (imgData.data[idx] + imgData.data[idx + 1] + imgData.data[idx + 2]) / 3;
    if (bright < 128 && firstDark === -1) firstDark = x;
    if (bright >= 128 && firstDark !== -1 && firstLight === -1) firstLight = x;
  }

  if (firstDark === -1 || firstLight === -1) return 21; // default

  // The finder pattern starts with 7 dark modules
  // Scan to find the repeating module size
  let moduleSize = 1;
  for (let x = firstDark + 1; x < width; x++) {
    const idx = x * 4;
    const bright = (imgData.data[idx] + imgData.data[idx + 1] + imgData.data[idx + 2]) / 3;
    if (bright < 128) {
      moduleSize++;
    } else {
      break;
    }
  }

  // First dark run in finder pattern = 1 module width
  // But the first element of the finder pattern is 7 modules wide
  // Actually, the first dark run in the top-left is the first module
  const cellSize = moduleSize;
  return Math.round(width / cellSize);
}

// QR size slider
document.getElementById('qrSize').oninput = function() {
  document.getElementById('qrSizeLabel').textContent = this.value + 'px';
};

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2000);
}
</script>

</body>
</html>
